<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <script type="text/javascript"
                src="http://d3js.org/d3.v3.min.js">
        </script>
    </head>

    <body>
        <script type="text/javascript">
   
            var w = 500;
            var h = 300;
            var projection = d3.geo.albersUsa()
                       .translate([w/2, h/2])
                       .scale([800]);
            var path = d3.geo.path().projection(projection);
            var svg = d3.select("body").append("svg")
                        .attr("width", w)
                        .attr("height", h);
            
            d3.json("us-states.json", function(error, json) {
                var states = svg.selectAll("path")
                    .data(json.features)                    
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("class","states")
                    .attr("stroke", "white")
                    .style("fill", "steelblue")

            var g = svg.append("g")
            
             g.selectAll("text")
                .data(json.features)
                .enter()
                .append("svg:text")
                .text(function(d){
                    return d.properties.name;
                })
                .attr("x", function(d){
                    return path.centroid(d)[0];
                })
                .attr("y", function(d){
                    return  path.centroid(d)[1];
                })
                .attr("text-anchor","middle")
                .attr('font-size','5pt')
                .attr('fill', 'white')


            d3.csv("2015AllOccupations.csv", function(csvdata){     
                var values = [];
                for (var i=0; i<csvdata.states.length;i++){
                    console.log(csvdata[i]);
                    var name = csvdata[i].STATE;
                    console.log(name);
                    var value = csvdata[i].A_MEAN;
                    values[name] = value;                 
                }

            var maxvalue = 60000;
            var minvalue = 0;

            var linear = d3.scale.linear()
                        .domain([minvalue, maxvalue])
                        .range([0, 1]);

            var a = d3.rgb(0,255,255);  //浅蓝色
            var b = d3.rgb(0,0,255);    //蓝色
         
            var computeColor = d3.interpolate(a,b);
   
            //设定各省份的填充色
            states.style("fill", function(d,i){
                var t = linear(values[d[1]]);
                var color = computeColor(t);
                return color.toString();            
            }); 

        });

});

        </script>
    </body>
</html>